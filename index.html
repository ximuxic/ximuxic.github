<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>国际金价-人民币金价实时换算器</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;}
        body{max-width:600px;margin:20px auto;padding:0 15px;font-family:Arial;}
        .calc-box{padding:25px;border:1px solid #eee;border-radius:8px;margin-top:20px;}
        .item{margin:18px 0;}
        label{display:block;margin-bottom:8px;font-weight:500;color:#333;}
        input{width:100%;padding:10px;border:1px solid #ddd;border-radius:4px;font-size:16px;}
        button{width:100%;padding:12px;background:#0088ff;color:#fff;border:none;border-radius:4px;font-size:17px;cursor:pointer;}
        button:hover{background:#0077ee;}
        .btn-group{display:flex;gap:10px;margin-top:10px;}
        .btn-group button{flex:1;margin-top:0;}
        .btn-del{background:#ff4444!important;}
        .btn-del:hover{background:#ff3333!important;}
        .btn-refresh{background:#ff8800!important;}
        .btn-refresh:hover{background:#ff7700!important;}
        .result{margin-top:20px;padding:15px;background:#f5faff;border-radius:4px;font-size:18px;color:#0088ff;}
        .tips{margin-top:10px;font-size:14px;color:#666;}
        .history-box{margin-top:30px;}
        .history-title{font-size:16px;font-weight:bold;color:#333;margin-bottom:10px;}
        .history-list{border:1px solid #eee;border-radius:8px;padding:10px;max-height:200px;overflow-y:auto;}
        .history-item{padding:8px 0;border-bottom:1px dashed #eee;font-size:14px;color:#666;display:flex;justify-content:space-between;}
        .history-item:last-child{border:none;}
        .history-time{color:#999;}
    </style>
</head>
<body>
    <h2 style="text-align:center;color:#333;">黄金实时换算器</h2>
    <div class="calc-box">
        <div class="item">
            <label>实时国际金价（美元/盎司）</label>
            <input type="number" id="goldUsd" placeholder="自动加载/手动输入" value="">
        </div>
        <div class="item">
            <label>实时美元兑人民币汇率</label>
            <input type="number" id="usdCny" placeholder="自动加载/手动输入" value="">
        </div>
        <div class="item">
            <label>人民币金价（元/克）</label>
            <input type="number" id="goldCny" placeholder="换算结果" readonly>
        </div>
        <button onclick="calcGold()">立即换算</button>
        <div class="btn-group">
            <button onclick="refreshData()" class="btn-refresh">刷新实时数据</button>
            <button onclick="clearHistory()" class="btn-del">清空历史</button>
        </div>
        <div class="tips">换算公式：人民币金价=国际金价×美元兑人民币汇率÷31.1035<br>1金衡盎司=31.1035克，数据实时更新，历史记录本地保存</div>
    </div>

    <div class="history-box">
        <div class="history-title">换算历史记录</div>
        <div class="history-list" id="historyList"></div>
    </div>

    <script>
        // 核心换算公式
        function calcGold(){
            const goldUsd = parseFloat(document.getElementById("goldUsd").value) || 0;
            const usdCny = parseFloat(document.getElementById("usdCny").value) || 0;
            const goldCny = (goldUsd * usdCny / 31.1035).toFixed(2);
            document.getElementById("goldCny").value = goldCny;
            
            // 换算成功才加历史记录
            if(goldUsd && usdCny && goldCny>0){
                addHistory(goldUsd, usdCny, goldCny);
            }
        }

        // 拉取实时金价+汇率（新浪免费接口，免key）
        function refreshData(){
            // 实时国际现货金价（美元/盎司）
            fetch('https://hq.sinajs.cn/list=hf_GC')
            .then(res => res.text())
            .then(data => {
                const goldData = data.split(',');
                const realGoldUsd = goldData[1];
                document.getElementById("goldUsd").value = realGoldUsd;
            }).catch(err => console.log("金价加载失败，可手动输入"));

            // 实时美元兑人民币汇率
            fetch('https://hq.sinajs.cn/list=fx_susdcny')
            .then(res => res.text())
            .then(data => {
                const rateData = data.split(',');
                const realRate = rateData[1];
                document.getElementById("usdCny").value = realRate;
            }).catch(err => console.log("汇率加载失败，可手动输入"));
        }

        // 新增历史记录（本地存储，清缓存才丢）
        function addHistory(goldUsd, usdCny, goldCny){
            const time = new Date().toLocaleString(); // 本地时间
            const history = {goldUsd, usdCny, goldCny, time};
            // 读取本地存储的历史
            let historyArr = JSON.parse(localStorage.getItem('goldCalcHistory')) || [];
            // 头部插入最新记录，最多存20条
            historyArr.unshift(history);
            if(historyArr.length>20) historyArr.pop();
            // 存回本地
            localStorage.setItem('goldCalcHistory', JSON.stringify(historyArr));
            // 渲染历史列表
            renderHistory();
        }

        // 渲染历史记录
        function renderHistory(){
            let historyArr = JSON.parse(localStorage.getItem('goldCalcHistory')) || [];
            const historyList = document.getElementById('historyList');
            if(historyArr.length===0){
                historyList.innerHTML = '<div style="text-align:center;padding:20px;color:#999;">暂无换算记录</div>';
                return;
            }
            let html = '';
            historyArr.forEach(item=>{
                html += `<div class="history-item">
                    <span>${item.goldUsd}$/盎司 × ${item.usdCny} = ${item.goldCny}元/克</span>
                    <span class="history-time">${item.time}</span>
                </div>`;
            });
            historyList.innerHTML = html;
        }

        // 清空历史记录
        function clearHistory(){
            localStorage.removeItem('goldCalcHistory');
            renderHistory();
        }

        // 页面加载初始化
        window.onload = function(){
            refreshData();
            setTimeout(calcGold, 800); // 延迟换算，确保数据加载
            renderHistory(); // 加载历史记录
        }
    </script>
</body>

</html>
